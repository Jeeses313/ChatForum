(this.webpackJsonpchatforum=this.webpackJsonpchatforum||[]).push([[0],{125:function(e,t,a){e.exports=a(147)},147:function(e,t,a){"use strict";a.r(t);var n=a(85),r=a(0),c=a.n(r),o=a(62),l=a.n(o),u=a(47),i=a(15),s=a(152),m=a(150),d=a(106),b=a(36),g=a(17);function f(){var e=Object(b.a)(["\n    mutation createUser($username: String!, $password: String!) {\n        createUser(username: $username, password: $password)  {\n            value\n            user {\n                username\n            }\n        }\n    }\n"]);return f=function(){return e},e}function E(){var e=Object(b.a)(["\n    mutation login($username: String!, $password: String!) {\n        login(username: $username, password: $password)  {\n            value\n            user {\n                username\n            }\n        }\n    }\n"]);return E=function(){return e},e}var p,v=Object(g.a)(E()),h=Object(g.a)(f()),O=a(19),j=a(155),S=function(){var e=Object(O.c)((function(e){return e.notification}));return""===e?c.a.createElement(c.a.Fragment,null):e.error?c.a.createElement(j.a,{variant:"danger",className:"errormessage"},e.message):c.a.createElement(j.a,{variant:"success",className:"message"},e.message)},w=a(43),y=a.n(w),C=a(65),T=function e(t,a){return function(){var n=Object(C.a)(y.a.mark((function n(r){return y.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:""!==t&&(clearTimeout(p),p=setTimeout((function(){r(e(""))}),1e3*a)),r({type:"SET NOTIFICATION",notification:t});case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET NOTIFICATION":return t.notification;default:return e}},x=function(e){return function(){var t=Object(C.a)(y.a.mark((function t(a){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a({type:"SET_TOKEN",data:e});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TOKEN":return t.data;default:return e}},I=function(e){return function(){var t=Object(C.a)(y.a.mark((function t(a){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a({type:"SET_USER",data:e});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":return t.data;default:return e}},D=a(22),L=function(){var e=Object(r.useState)(""),t=Object(i.a)(e,2),a=t[0],n=t[1],o=Object(r.useState)(""),l=Object(i.a)(o,2),b=l[0],g=l[1],f=Object(O.b)(),E=Object(u.g)(),p=Object(d.a)(v,{onError:function(e){f(T({message:e.graphQLErrors[0].message,error:!0},10))}}),h=Object(i.a)(p,2),j=h[0],w=h[1];Object(r.useEffect)((function(){if(w.data){var e=w.data.login.value,t=w.data.login.user;f(x(e)),localStorage.setItem("user-token",e),E.push("/"),localStorage.setItem("logged-user",JSON.stringify(t)),f(I(t)),f(T({message:"Logged in",error:!1},10))}}),[w.data]);return c.a.createElement("div",{className:"container"},c.a.createElement("h2",null,"Login"),c.a.createElement(S,null),c.a.createElement(s.a,{onSubmit:function(e){e.preventDefault(),j({variables:{username:a,password:b}}),n(""),g("")}},c.a.createElement(s.a.Label,null,"username:"),c.a.createElement(s.a.Control,{type:"text",id:"username",value:a,name:"username",onChange:function(e){var t=e.target;return n(t.value)},required:!0}),c.a.createElement(s.a.Label,null,"password:"),c.a.createElement(s.a.Control,{type:"password",id:"password",value:b,name:"password",onChange:function(e){var t=e.target;return g(t.value)},required:!0}),c.a.createElement(m.a,{id:"submit",type:"submit"},"login")," or ",c.a.createElement(D.b,{to:"/signin"},"signin")))},q=a(154),F=a(153),A=function(){var e=Object(O.c)((function(e){return e.user})),t=Object(O.b)(),a=Object(u.g)();return c.a.createElement(c.a.Fragment,null,c.a.createElement(q.a,{collapseOnSelect:!0,expand:"lg",bg:"dark",variant:"dark"},c.a.createElement(q.a.Brand,{href:"",as:"span"},"ChatForum"),c.a.createElement(q.a.Toggle,{"aria-controls":"responsive-navbar-nav"}),c.a.createElement(q.a.Collapse,{id:"responsive-navbar-nav"},c.a.createElement(F.a,{className:"mr-auto"},c.a.createElement(F.a.Link,{href:"#",as:"span"},c.a.createElement(m.a,{variant:"outline-info",onClick:function(){a.push("/chats")}},"Chats")),c.a.createElement(F.a.Link,{href:"#",as:"span"},c.a.createElement("div",null,c.a.createElement(D.b,{to:"/"},e.username)," logged in ",c.a.createElement(m.a,{variant:"outline-info",onClick:function(){window.localStorage.removeItem("user-token"),window.localStorage.removeItem("logged-user"),t(I(null)),t(x("")),t(T({message:"logged out",error:!1},5)),a.push("/login")}},"logout")))))),c.a.createElement(S,null))},z=a(105),R=a(107);function B(){var e=Object(b.a)(["\n    subscription {\n        chatAdded {\n            title\n            latestComment {\n                content\n                date\n                user {\n                    username\n                }\n            }\n            date\n        }\n    }\n"]);return B=function(){return e},e}function U(){var e=Object(b.a)(["\n    query {\n        chats {\n            title\n            latestComment{\n                content\n                date\n                user{\n                    username\n                }\n            }\n            date\n        }\n    }\n"]);return U=function(){return e},e}function J(){var e=Object(b.a)(["\n    mutation createChat($chatTitle: String!) {\n        createChat(chatTitle: $chatTitle)  {\n            title\n        }\n    }\n"]);return J=function(){return e},e}var Q=Object(g.a)(J()),_=Object(g.a)(U()),K=Object(g.a)(B());function P(){var e=Object(b.a)(["\n    subscription {\n        commentAdded {\n            comment {\n                user { \n                    username\n                }\n                date\n                content\n                id\n            }\n            chatTitle\n        }\n    }\n"]);return P=function(){return e},e}function W(){var e=Object(b.a)(["\n    query comments($chatTitle: String){\n        comments(chatTitle: $chatTitle) {\n            content\n            date\n            user{\n                username\n            }\n            id\n        }\n    }\n"]);return W=function(){return e},e}function Y(){var e=Object(b.a)(["\n    mutation createComment($chatTitle: String!, $content: String!) {\n        createComment(chatTitle: $chatTitle, content: $content)  {\n            content\n            date\n            user{\n                username\n            }\n        }\n    }\n"]);return Y=function(){return e},e}var M=Object(g.a)(Y()),V=Object(g.a)(W()),G=Object(g.a)(P()),H=function(e){var t=e.chat,a="No comments yet.",n={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},r=new Date(t.date).toLocaleTimeString([],n);t.latestComment&&(a=t.latestComment.content.length>30?"".concat(t.latestComment.content.substring(0,30),"... -").concat(t.latestComment.user.username):"".concat(t.latestComment.content," -").concat(t.latestComment.user.username),r=new Date(t.latestComment.date).toLocaleTimeString([],n));return c.a.createElement("div",{style:{borderStyle:"solid",borderRadius:"5px",padding:"10px",marginBottom:"10px"}},c.a.createElement("div",null,c.a.createElement(D.b,{to:"/chats/".concat(t.title)},t.title)),c.a.createElement("div",null,a),c.a.createElement("div",null,r))},X=a(151),Z=a(112),ee=function(){var e=Object(r.useState)(""),t=Object(i.a)(e,2),a=t[0],n=t[1],o=Object(O.b)(),l=Object(u.g)(),b=Object(d.a)(Q,{onError:function(e){o(T({message:e.graphQLErrors[0].message,error:!0},10))}}),g=Object(i.a)(b,2),f=g[0],E=g[1];return Object(r.useEffect)((function(){E.data&&l.push("/chats/".concat(E.data.createChat.title))}),[E.data]),c.a.createElement(c.a.Fragment,null,c.a.createElement(s.a,{onSubmit:function(e){e.preventDefault(),f({variables:{chatTitle:a}}),n("")}},c.a.createElement(X.a,{size:"lg"},c.a.createElement(Z.a,{md:"10"},c.a.createElement(s.a.Control,{as:"textarea",rows:"1",style:{resize:"none"},id:"content",value:a,name:"content",onChange:function(e){var t=e.target;return n(t.value)},placeholder:"Title...",required:!0,block:"true"})),c.a.createElement(Z.a,{md:"2"},c.a.createElement(m.a,{id:"submit",type:"submit",size:"lg",block:!0},"Start new chat")))))},te=function(){var e=Object(r.useState)([]),t=Object(i.a)(e,2),a=t[0],o=t[1],l=Object(z.a)(_),u=Object(i.a)(l,2),s=u[0],m=u[1];Object(r.useEffect)((function(){s()}),[]),Object(r.useEffect)((function(){m.data&&o(m.data.chats.sort((function(e,t){var a=e.date;e.latestComment&&(a=e.latestComment.date);var n=t.date;return t.latestComment&&(n=t.latestComment.date),n-a})))}),[m.data]),Object(R.a)(K,{onSubscriptionData:function(e){var t=e.subscriptionData.data.chatAdded,n=a.concat(t);n.sort((function(e,t){var a=e.date;e.latestComment&&(a=e.latestComment.date);var n=t.date;return t.latestComment&&(n=t.latestComment.date),n-a})),o(n)}}),Object(R.a)(G,{onSubscriptionData:function(e){var t=e.subscriptionData,r=t.data.commentAdded.comment,c=t.data.commentAdded.chatTitle,l=a.map((function(e){return e.title===c?Object(n.a)({},e,{latestComment:r}):e}));l.sort((function(e,t){var a=e.date;e.latestComment&&(a=e.latestComment.date);var n=t.date;return t.latestComment&&(n=t.latestComment.date),n-a})),o(l)}});return c.a.createElement(c.a.Fragment,null,c.a.createElement("h2",null,"Chats"),c.a.createElement("div",{style:{borderStyle:"solid",borderRadius:"5px",borderColor:"grey",padding:"10px",marginBottom:"10px",overflowY:"scroll",height:"75vh"}},a.map((function(e){return c.a.createElement(H,{key:e.title,chat:e})}))),c.a.createElement(ee,null))},ae=function(e){var t=e.comment,a=new Date(t.date).toLocaleTimeString([],{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return c.a.createElement("div",{style:{borderStyle:"solid",borderRadius:"5px",padding:"10px",marginBottom:"10px"}},c.a.createElement("div",null,t.user.username," ",a),c.a.createElement("textarea",{rows:"2",value:t.content,readOnly:!0,style:{width:"100%",resize:"none",border:"none"},block:"true"}))},ne=function(e){var t=e.title,a=Object(r.useState)(""),n=Object(i.a)(a,2),o=n[0],l=n[1],u=Object(O.b)(),b=Object(d.a)(M,{onError:function(e){u(T({message:e.graphQLErrors[0].message,error:!0},10))}}),g=Object(i.a)(b,2),f=g[0];g[1];return c.a.createElement(c.a.Fragment,null,c.a.createElement(s.a,{onSubmit:function(e){e.preventDefault(),f({variables:{chatTitle:t,content:o}}),l("")}},c.a.createElement(X.a,{size:"lg"},c.a.createElement(Z.a,{md:"10"},c.a.createElement(s.a.Control,{as:"textarea",rows:"2",style:{resize:"none"},id:"content",value:o,name:"content",onChange:function(e){var t=e.target;return l(t.value)},placeholder:"New comment...",required:!0,block:"true"})),c.a.createElement(Z.a,{md:"2"},c.a.createElement(m.a,{id:"submit",type:"submit",size:"lg",block:!0},"Send")))))},re=function(){var e=Object(r.useState)([]),t=Object(i.a)(e,2),a=t[0],n=t[1],o=Object(z.a)(V),l=Object(i.a)(o,2),s=l[0],m=l[1],d=Object(u.h)("/chats/:title"),b=d?d.params.title:null,g=Object(r.useRef)(null);Object(r.useEffect)((function(){s({variables:{chatTitle:b}})}),[]),Object(r.useEffect)((function(){m.data&&n(m.data.comments.sort((function(e,t){return e.date-t.date})))}),[m.data]),Object(r.useEffect)((function(){g.current.scrollIntoView({behavior:"smooth"})}),[a]),Object(R.a)(G,{onSubscriptionData:function(e){var t=e.subscriptionData,r=t.data.commentAdded.comment;if(t.data.commentAdded.chatTitle===b){var c=a.concat(r);c.sort((function(e,t){return e.date-t.date})),n(c)}}});return c.a.createElement(c.a.Fragment,null,c.a.createElement("h2",null,b),c.a.createElement("div",{style:{borderStyle:"solid",borderRadius:"5px",borderColor:"grey",padding:"10px",marginBottom:"10px",overflowY:"scroll",height:"70vh"}},0===a.length?c.a.createElement("div",null,"No comments yet"):a.map((function(e){return c.a.createElement(ae,{key:e.id,comment:e})})),c.a.createElement("div",{ref:g})),c.a.createElement(ne,{title:b}))},ce=function(){return c.a.createElement(c.a.Fragment,null,c.a.createElement(A,null),c.a.createElement("div",{className:"container"},c.a.createElement(u.d,null,c.a.createElement(u.b,{path:"/chats/:title"},c.a.createElement(re,null)),c.a.createElement(u.b,{path:"/chats"},c.a.createElement(te,null)),c.a.createElement(u.b,{path:"/"},c.a.createElement("h1",null,"Welcome")))))},oe=function(){var e=Object(r.useState)(""),t=Object(i.a)(e,2),a=t[0],n=t[1],o=Object(r.useState)(""),l=Object(i.a)(o,2),b=l[0],g=l[1],f=Object(O.b)(),E=Object(u.g)(),p=Object(d.a)(h,{onError:function(e){f(T({message:e.graphQLErrors[0].message,error:!0},10))}}),v=Object(i.a)(p,2),j=v[0],w=v[1];Object(r.useEffect)((function(){if(w.data){var e=w.data.createUser.value,t=w.data.createUser.user;f(x(e)),localStorage.setItem("user-token",e),E.push("/"),localStorage.setItem("logged-user",JSON.stringify(t)),f(I(t)),f(T({message:"Signed in",error:!1},10))}}),[w.data]);return c.a.createElement("div",{className:"container"},c.a.createElement("h2",null,"Signin"),c.a.createElement(S,null),c.a.createElement(s.a,{onSubmit:function(e){e.preventDefault(),j({variables:{username:a,password:b}}),n(""),g("")}},c.a.createElement(s.a.Label,null,"username:"),c.a.createElement(s.a.Control,{type:"text",id:"username",value:a,name:"username",onChange:function(e){var t=e.target;return n(t.value)},required:!0}),c.a.createElement(s.a.Label,null,"password:"),c.a.createElement(s.a.Control,{type:"password",id:"password",value:b,name:"password",onChange:function(e){var t=e.target;return g(t.value)},required:!0}),c.a.createElement(m.a,{id:"submit",type:"submit"},"signin")," or ",c.a.createElement(D.b,{to:"/login"},"login")))},le=function(){var e=Object(O.c)((function(e){return e.token}));return c.a.createElement("div",null,c.a.createElement(u.d,null,c.a.createElement(u.b,{path:"/signin"},e?c.a.createElement(u.a,{to:"/login"}):c.a.createElement(oe,null)),c.a.createElement(u.b,{path:"/login"},e?c.a.createElement(u.a,{to:"/login"}):c.a.createElement(L,null)),c.a.createElement(u.b,{path:"/"},e?c.a.createElement(c.a.Fragment,null,c.a.createElement(ce,null)):c.a.createElement(u.a,{to:"/login"}))))},ue=a(56),ie=a(74),se=a(75),me=a(76),de=a(104),be=a(120),ge=a(116),fe=a(119),Ee=a(52),pe=a(117),ve=a(118),he=Object(Ee.combineReducers)({notification:k,user:$,token:N}),Oe=Object(Ee.createStore)(he,Object(pe.composeWithDevTools)(Object(Ee.applyMiddleware)(ve.a))),je=Object(be.a)((function(e,t){var a=t.headers,r=localStorage.getItem("user-token");return{headers:Object(n.a)({},a,{authorization:r?"bearer ".concat(r):null})}})),Se=new ue.a({uri:"/graphql"}),we=new fe.a({uri:"wss://".concat(window.location.host,"/graphql"),options:{reconnect:!0}}),ye=Object(ie.a)((function(e){var t=e.query,a=Object(ge.a)(t);return"OperationDefinition"===a.kind&&"subscription"===a.operation}),we,je.concat(Se)),Ce=new se.a({cache:new me.a,link:ye,defaultOptions:{watchQuery:{fetchPolicy:"no-cache"},query:{fetchPolicy:"no-cache"}}}),Te=localStorage.getItem("user-token"),ke=localStorage.getItem("logged-user");Te&&Oe.dispatch(x(Te)),ke&&Oe.dispatch(I(JSON.parse(ke))),l.a.render(c.a.createElement(de.a,{client:Ce},c.a.createElement(O.a,{store:Oe},c.a.createElement(D.a,null,c.a.createElement(le,null)))),document.getElementById("root"))}},[[125,1,2]]]);
//# sourceMappingURL=main.87b9e133.chunk.js.map